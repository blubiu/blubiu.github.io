---
layout: post
title: "汇编语言笔记(五)--栈"
date: 2019-12-25
description: "汇编语言"
tag: 汇编语言
---
---

### 前言：

栈。

---


### 目录：

* <a href="#a" target="_self">栈</a>
* <a href="#b" target="_self">栈空</a>
* <a href="#c" target="_self">栈顶超界的问题</a>
* <a href="#zg" target="_self">总结</a>

-----


### <span id = "a">栈：</span>

栈是一种具有特殊的访问方式的存储空间。它的特殊性就在于，最后进入这个空间的数据，最先出去。<br>

入栈和出栈指令：<br>

push 入栈 <br>

比如，`push ax` 表示将寄存器 **ax** 中的数据送入栈中 <br>

**pop** 出栈 <br>

比如，`pop ax` 表示从栈顶取出数据送入 **ax** <br>

那么问题来了，CPU 如何知道当前要执行的指令所在位置  <br>

那就是 **CS、IP** 中存放着当前指令的段地址和偏移地址 <br>

现在CPU如何知道栈顶的位置？<br>

很显然也应该有相应的寄存器来存放栈顶的地址 <br>

这两个寄存器分别是 **段寄存器 SS** 和 **寄存器 SP** <br>

栈顶的段地址存放在 **SS** 中，<br>

偏移地址存放在 **SP** 中 <br>

任意时刻，**SS:SP** 指向栈顶元素 。

-----


### <span id = "b">栈空：</span>

如果将 **10000H-1000FH** 这段空间当作栈，初始状态栈是空的，<br>

此时，**SS=1000H** ，**SP=?** <br>

![images](/images/2019-12-15/03.png)

-----

如图所示，将 **10000H-1000FH** 这段空间当作栈，**SS=1000H** ，栈空间大小为16字节，<br>

栈最底部的字单元地址为 **1000:000E** 。任意时刻，**SS:SP** 指向栈顶，<br>

当栈中只有一个元素的时候，**SS=1000H** ，**SP=000EH** 。栈为空，<br>

就相对于栈中唯一的元素出栈，出栈后，**SP=SP+2** ，**SP** 原来为 **000EH** ，加2后 **SP=10H** ，<br>

所以，当栈为空的时候，**SS=1000H** ，**SP=10H** 。<br>

-----

换一个角度看，任意时刻，**SS:SP** 指向栈顶元素，当栈为空的时候，栈中没元素，<br>

也就不存在栈顶元素，所以 **SS:SP** 只能指向栈的最底部单元下面的单元，<br>

该单元的偏移地址为栈最底部的字单元的 **偏移地址+2** ， <br>

栈最底部字单元的地址为 **1000:000E** ，所以栈空时，**SP=0010H**。

-----


### <span id = "c">栈顶超界的问题：</span>

栈顶超界 简单的讲就是有一段栈空间，<br>

如果 **push** 或者 **pop** 数据过多将会超出这段空间 <br>

-----

#### push 超界

将 **10010H-1001FH** 当作栈空间，该栈空间容量为16字节(8字节)，初始状态为空，<br>

**SS=1000H** 、**SP=0020H** ，**SS:SP** 指向 **10020H** ； <br>

每执行一次 **push ax** ，**SP=SP-2** ，<br>

在执行 8次 **push ax** 后，向栈中压入8个字，栈满，**SS:SP** 指向 **10010H** ； <br>

再次执行 **push ax** 后 **sp=sp-2**，**SS:SP** 指向 **1000EH** ，栈顶超出了栈空间，<br>

**ax** 中的数据送入 **1000EH** 单元处，将栈空间外的数据覆盖。<br>

![images](/images/2019-12-15/04.png)

-----

#### pop 超界

将 **10010H-1001FH** 当作栈空间，该栈空间容量为16字节(8字节)，初始状态为空，<br>

**SS=1000H**、**SP=0010H**，**SS:SP** 指向**10010H**； <br> 

在执行 8次 `push ax` 后，向栈中弹出8个字，栈空，**SS:SP** 指向 **10020H**； <br>

再次执行 **push ax** 后 **sp=sp+2**，**SS:SP** 指向 **10022EH**，栈顶超出了栈空间，<br>

此后，如果再执行push指令，**10020H**、**10021H** 中的数据都将被覆盖。<br>

![images](/images/2019-12-15/05.png)


-----


### <span id = "zg">总结</span>

栈。

--------
