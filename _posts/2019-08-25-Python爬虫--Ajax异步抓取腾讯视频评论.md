---
layout: post
title: "Pythonçˆ¬è™«--Ajaxå¼‚æ­¥æŠ“å–è…¾è®¯è§†é¢‘è¯„è®º"
date: 2019-08-25
description: "Python çˆ¬è™«"
tag: Python çˆ¬è™«
---
---

### å‰è¨€ï¼š

åœ¨æŸäº›ç½‘ç«™ ï¼Œå½“æˆ‘ä»¬æ»‘ä¸‹å»çš„æ—¶å€™æ‰ä¼šæ˜¾ç¤ºå‡ºåé¢çš„å†…å®¹ <br>

å°±åƒæ·˜å®ä¸€æ ·ï¼Œæ»‘ä¸‹å»æ‰é€æ¸æ˜¾ç¤ºå…¶ä»–å•†å“ <br>

è¿™ä¸ªå°±æ˜¯é‡‡ç”¨ **Ajax** åšçš„ <br>

ç„¶åæˆ‘ä»¬ç°åœ¨å°±æ˜¯è¦ç¼–å†™è¿™æ ·çš„çˆ¬è™«ã€‚

---


### ç›®å½•ï¼š

* <a href="#a" target="_self">è§„å¾‹åˆ†æ</a>
* <a href="#b" target="_self">åªæŠ“å–ä¸€é¡µçš„è¯„è®º</a>
* <a href="#c" target="_self">è‡ªåŠ¨æŠ“å–å…¨éƒ¨è¯„è®º</a>
* <a href="#zg" target="_self">æ€»ç»“</a>

-------


### <span id = "a">è§„å¾‹åˆ†æï¼š</span>

è¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°æˆ‘ä»¬çš„ **Fiddler** äº† <br>

æˆ‘ä»¬éœ€è¦åˆ†æåŠ è½½è¯„è®ºçš„è§„å¾‹ <br>

é¦–å…ˆä½¿ç”¨ç«ç‹æµè§ˆå™¨éšä¾¿æ‰“å¼€ä¸€ä¸ªè§†é¢‘ï¼Œæ³¨æ„è®¾ç½®å¥½ä»£ç† <br>

ç„¶åæ‰“å¼€ **Fiddler** æŠ“åŒ… ï¼Œç„¶åå†ç‚¹å‡»æŸ¥çœ‹æ›´å¤šè¯„è®ºï¼Œ<br>

æ‹¿é­”é“ç¥–å¸ˆæ¼”ç¤ºå§ï¼Œæ¯•ç«Ÿæˆ‘ä¹Ÿå–œæ¬¢çœ‹ <br>

å°±æ˜¯è¿™ä¸ªä½ç½® <br>

![images](/images/2019-08-25/01.png)

-----

ç„¶åæŸ¥çœ‹ **Fiddler** <br>

æŠ“åˆ°çš„ä¸œè¥¿å°±å¾ˆå¤šæ‚ä¸ƒæ‚å…«çš„äº†ï¼Œ<br>

æœ‰é“¾æ¥å•Šï¼Œå›¾ç‰‡ä»€ä¹ˆçš„ï¼Œè¿™äº›æ˜¾ç„¶ä¸æ˜¯è¯„è®º <br>

![images](/images/2019-08-25/02.png)

-----

ç„¶åæŸ¥çœ‹ä¸€ä¸ª **js** æ–‡ä»¶ ï¼Œå‘ç°è¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¯„è®º <br>

![images](/images/2019-08-25/03.png)

-----

ç„¶åæŠŠè¯„è®ºçš„ **url** å¤åˆ¶å‡ºæ¥åˆ†æè§„å¾‹ <br>

å³é”®ç‚¹å‡» **js** é“¾æ¥ï¼Œç„¶åå†é€‰æ‹© **Copy --> Just Url** <br>

![images](/images/2019-08-25/04.png)

-----

å¦‚æœä¸€æ¡åˆ†æä¸äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¤šåŠ è½½ä¸€ä¸¤æ¡çœ‹çœ‹ <br>

è¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸‰æ¡åšåˆ†æäº† <br>

![images](/images/2019-08-25/05.png)

-----

é¦–å…ˆçœ‹è¿™ä¸ªåœ°æ–¹ï¼Œ<br>

è¿™ä¸ªåº”è¯¥æ˜¯è¿™éƒ¨è§†é¢‘çš„ **id**  **2850613872** <br>

![images](/images/2019-08-25/06.png)

-----

æ¥ä¸‹æ¥æ˜¯è¯„è®º **id** <br>

ä½†æ˜¯è²Œä¼¼ **id** éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘å¯ä»¥æ‰“å¼€è¯„è®ºé“¾æ¥çœ‹çœ‹æœ‰æ²¡æœ‰è§„å¾‹ <br>

![images](/images/2019-08-25/07.png)

-----

æ‰“å¼€ç¬¬ä¸€ä¸ªè¯„è®ºé“¾æ¥ï¼Œ<br>

ç„¶åå‘ç°ç¬¬ä¸€ä¸ªè¯„è®ºé“¾æ¥é‡Œçš„ **last** **6426734762166565246** æ­£å¥½æ˜¯ç¬¬äºŒæ¡è¯„è®ºé“¾æ¥é‡Œé¢çš„ **id** <br>

ç„¶åæŸ¥çœ‹å…¶ä»–çš„ï¼Œå‘ç°ä¾æ—§å¦‚æ­¤ <br>

ç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªç»“è®ºï¼Œ<br>

å°±æ˜¯ç¬¬ä¸€æ¡è¯„è®ºé“¾æ¥é‡Œé¢çš„ **last id** ç­‰äº ç¬¬äºŒæ¡è¯„è®ºé“¾æ¥é‡Œé¢çš„ **id** <br>

![images](/images/2019-08-25/08.png)

-----

å‘ç°è¯„è®º **id** çš„è§„å¾‹åï¼Œ<br>

æ¥ä¸‹æ¥å°±æ˜¯è¯„è®ºäº† <br>

è¯„è®ºå†…å®¹åœ¨ **content** é‡Œé¢ <br>

![images](/images/2019-08-25/09.png)

-----

åé¢è¿™ä¸ªå­—ç¬¦ä¸²çš„è¯ <br>

å‰åä½æ˜¯æ—¶é—´æˆ³ï¼Œåé¢ä¸‰ä½æ²¡æœ‰å‘ç°æœ‰å•¥è§„å¾‹ <br>

å¤ªèœäº†æˆ‘ <br>

æ¨æµ‹å¯èƒ½æ˜¯è¯„è®ºæ•° <br>

ä¸è¿‡æœ‰æ²¡æœ‰è¿™ä¸ªå­—ç¬¦ä¸²çŸ­æ—¶é—´å†…ä¸å½±å“æˆ‘ä»¬è·å–è¯„è®ºå†…å®¹ <br>

è¿™ä¸ªæ„Ÿè§‰å°±æ˜¯ä¸€ä¸ªæ—¶é—´é™åˆ¶ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…æœ‰æ•ˆ <br>

![images](/images/2019-08-25/12.png)

-----


### <span id = "b">åªæŠ“å–ä¸€é¡µçš„è¯„è®ºï¼š</span>

çŸ¥é“è§„å¾‹å <br>

å¯ä»¥è¯•è¯•æŠ“å–è¯„è®ºå†…å®¹ <br>

æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•åªæŠ“å–ä¸€ä¸ªé“¾æ¥é‡Œé¢çš„å†…å®¹ <br>

ä»£ç ï¼š<br>

```python
import urllib.request
import re
import time

headers = (

	"User-Agent","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36"

	)

opener = urllib.request.build_opener()

opener.addheaders = [headers]

urllib.request.install_opener(opener)

video_id = "2850613872"

comment_id = "6422202556761345058"

url = "https://video.coral.qq.com/varticle/"+video_id+"/comment/v2?callback=_varticle2850613872commentv2&orinum=10&oriorder=o&pageflag=1&cursor="+comment_id+"&scorecursor=0&orirepnum=2&reporder=o&reppageflag=1&source=132&_=1566709851532"

path = '"content":"(.*?)",'

data = urllib.request.urlopen(url).read().decode("utf-8")

resut = re.compile(path).findall(data)

print(resut)
```

ç„¶åå°±è·å–åˆ°äº†ä¸€é¡µçš„è¯„è®º ğŸ˜‚ğŸ˜‚ â¤â¤ ğŸ™ƒğŸ™ƒ (ëˆˆ_ëˆˆ)(ëˆˆ_ëˆˆ) <br>

ğŸ˜¡ğŸ˜¡ ğŸ˜ŠğŸ˜Š ğŸ˜„ğŸ˜„ ğŸ¤£ğŸ¤£ ğŸ˜’ğŸ˜’ ğŸ¤¬ğŸ¤¬ ğŸ˜˜ğŸ˜˜ <br>

![images](/images/2019-08-25/10.png)

-----


### <span id = "c">è‡ªåŠ¨æŠ“å–å…¨éƒ¨è¯„è®ºï¼š</span>

æ¥ä¸‹æ¥å°±è¦æŠ“å–å…¨éƒ¨è¯„è®ºäº† <br>

æ€è·¯ï¼š <br>

è·å– **last id** ä½œä¸ºä¸‹ä¸€æ¬¡é“¾æ¥çš„è¯„è®º id <br>

ä»£ç ï¼š <br>

```python
import urllib.request
import re
import time

try:

	headers = (

	"User-Agent","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36"

	)

	opener = urllib.request.build_opener()

	opener.addheaders = [headers]

	urllib.request.install_opener(opener)

	video_id = "2850613872"  #  è§†é¢‘ id

	comment_id = "6422202556761345058"  #  åˆå§‹è¯„è®º id

	for i in range(1,6):

		print("ç¬¬"+str(i)+"é¡µ")

		url = "https://video.coral.qq.com/varticle/"+video_id+"/comment/v2?callback=_varticle2850613872commentv2&orinum=10&oriorder=o&pageflag=1&cursor="+str(comment_id)+"&scorecursor=0&orirepnum=2&reporder=o&reppageflag=1&source=132&_=1566709851532"

		content_path = '"content":"(.*?)",'  #  è¯„è®ºå†…å®¹æ­£åˆ™

		last_path = '"last":"(.*?)",'  #  last id æ­£åˆ™

		content_data = urllib.request.urlopen(url).read().decode("utf-8")

		content = re.compile(content_path).findall(content_data)  #  è·å–è¯„è®º

		last_id = re.compile(last_path).findall(content_data)  # è·å– last id

		for j in last_id:  #  è·å–çš„ last id æ˜¯åˆ—è¡¨ç±»å‹ï¼Œè¦è¿›è¡Œç±»å‹è½¬æ¢

			comment_id = j

		# print(comment_id)

		print(content)  #  è¾“å‡ºè·å–çš„è¯„è®º

except Exception as error:

	print(error)
```

ç„¶åæˆåŠŸè·å–åˆ°è¯„è®º <br>

è¿è¡Œæˆªå›¾ <br>

![images](/images/2019-08-25/11.png)

-----


### <span id = "zg">æ€»ç»“ï¼š</span>

æ€ä¹ˆè®² <br>

tenx çš„åçˆ¬ç­–ç•¥åšçš„è¿˜æ˜¯æŒºä¸é”™çš„ <br>

å¤šç”¨ç‚¹å¿ƒæˆ‘ä»¬ä¹Ÿè¡Œã€‚

--------
